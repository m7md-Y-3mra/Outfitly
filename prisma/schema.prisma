// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}


enum WardrobeStyle {
  CASUAL
  FORMAL
  WORK
  SPORTY
  STREETWEAR
  LOUNGEWEAR
  PARTY
}

enum Season {
  SPRING
  SUMMER
  FALL
  WINTER
  ALL_YEAR
}

model User {
  id            String    @id @default(uuid())
  fullName      String?
  email         String    @unique
  emailVerified Boolean   @default(false)
  password      String
  avatarUrl     String?
  bio           String?   // Added
  location      String?   // Added
  website       String?   // Added
  isActive      Boolean   @default(true)
  lastLogin     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Add these for following/followers
  following     User[]    @relation("UserFollows")  // Users this user is following
  followers     User[]    @relation("UserFollows")  // Users following this user

  // Relations (unchanged)
  addresses       UserAddress[]
  orders          Order[]
  cartItems       CartItem[]
  outfits         Outfit[]
  favoriteOutfits Outfit[]       @relation("FavoriteOutfits")
  likedOutfits    Outfit[]       @relation("LikedOutfits")
  wardrobeItems   WardrobeItem[]
  productReviews  ProductReview[]
}

model UserAddress {
  id           String  @id @default(uuid())
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  zip          String
  country      String
  userId       String
  isDefault    Boolean @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Product {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String?
  basePrice   Decimal  @db.Decimal(10, 2)
  salePrice   Decimal? @db.Decimal(10, 2)
  gender      String? // male, female, unisex
  season      String? // spring, summer, fall, winter, all-year
  logoUrl     String?
  brandId     String
  categoryId  String?

  brand    Brand     @relation(fields: [brandId], references: [id])
  category Category? @relation(fields: [categoryId], references: [id])

  variants       ProductVariant[]
  images         ProductImage[]
  orderItems     OrderItem[]
  cartItems      CartItem[]
  productReviews ProductReview[]

  @@index([brandId])
  @@index([categoryId])
  @@index([slug])
}

model Brand {
  id      String  @id @default(uuid())
  name    String  @unique
  slug    String  @unique
  logoUrl String?

  products Product[]
}

model Category {
  id   String @id @default(uuid())
  name String
  slug String @unique

  products Product[]
  wardrobeItem WardrobeItem[]
}

model ProductVariant {
  id              String  @id @default(uuid())
  sku             String  @unique
  size            String
  colorId         String
  quantity        Int     @default(0)
  additionalPrice Decimal @default(0.00) @db.Decimal(8, 2)
  productId       String

  product Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  color   ProductColor @relation(fields: [colorId], references: [id])

  orderItems    OrderItem[]
  cartItems     CartItem[]
  wardrobeItems WardrobeItem[]
  outfitItems   OutfitItem[]

  @@index([productId])
  @@index([sku])
}

model ProductColor {
  id      String @id @default(uuid())
  name    String
  hexCode String 

  variants ProductVariant[]
}

model ProductImage {
  id           String  @id @default(uuid())
  imageUrl     String
  altText      String?
  displayOrder Int     @default(0)
  isPrimary    Boolean @default(false)
  productId    String

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model ProductReview {
  id                 String   @id @default(uuid())
  rating             Int      @db.SmallInt // 1-5
  title              String?
  comment            String?
  isVerifiedPurchase Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  productId String
  userId    String

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
}

model Order {
  id              String   @id @default(uuid())
  subtotal        Decimal  @db.Decimal(10, 2)
  taxAmount       Decimal  @db.Decimal(10, 2)
  shippingAmount  Decimal  @db.Decimal(10, 2)
  totalAmount     Decimal  @db.Decimal(10, 2)
  status          String // pending, paid, shipped, delivered, cancelled
  billingAddress  String?
  shippingAddress String?
  createdAt       DateTime @default(now())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  items       OrderItem[]
  transaction Transaction?

  @@index([userId])
}

model OrderItem {
  id         String  @id @default(uuid())
  quantity   Int
  unitPrice  Decimal @db.Decimal(10, 2)
  totalPrice Decimal @db.Decimal(10, 2)

  orderId          String
  productId        String
  productVariantId String

  order   Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product        @relation(fields: [productId], references: [id])
  variant ProductVariant @relation(fields: [productVariantId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([productVariantId])
}

model Transaction {
  id        String   @id @default(uuid())
  orderId   String   @unique
  amount    Decimal  @db.Decimal(10, 2)
  status    String // success, failed, pending
  gateway   String // stripe, paypal, etc.
  createdAt DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id])
}

model CartItem {
  id        String   @id @default(uuid())
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId           String
  productId        String
  productVariantId String?

  user    User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [productVariantId], references: [id])

  @@index([userId])
  @@index([productId])
  @@index([productVariantId])
}

// === Personal Styling / Outfit Feature ===

model Occasion {
  id          String  @id @default(uuid())
  name        String // e.g., Wedding, Office, Casual, Party, Beach
  description String?
  iconUrl     String?

  outfits Outfit[]
}

model Outfit {
  id            String   @id @default(uuid())
  name          String
  description   String?
  imageUrl      String?
  isAiGenerated Boolean  @default(false)
  visibility    String   @default("private") // public, private, friends
  createdAt     DateTime @default(now())
  season        Season?
  userId     String
  occasionId String?

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  occasion Occasion? @relation(fields: [occasionId], references: [id])

  items       OutfitItem[]
  favoritedBy User[]       @relation("FavoriteOutfits")
  likedBy     User[]       @relation("LikedOutfits")

  @@index([userId])
  @@index([occasionId])
}



model OutfitItem {
  id               String  @id @default(uuid())
  outfitId         String
  wardrobeItemId   String?
  productVariantId String?

  outfit       Outfit          @relation(fields: [outfitId], references: [id], onDelete: Cascade)
  wardrobeItem WardrobeItem?   @relation(fields: [wardrobeItemId], references: [id])
  product      ProductVariant? @relation(fields: [productVariantId], references: [id])


  @@index([outfitId])
  @@index([wardrobeItemId])
  @@index([productVariantId])

}

model WardrobeItem {
  id            String   @id @default(uuid())
  userId        String
  categoryId    String
  variantId     String?
  name          String
  color         String
  size          String
  brand         String
  season        String
  notes         String
  source        String   @default("manual")
  addedAt       DateTime @default(now())
  purchasedDate DateTime

  style         WardrobeStyle  @default(CASUAL) // <── NEW.

  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  variant   ProductVariant?  @relation(fields: [variantId], references: [id])
  category  Category?        @relation(fields: [categoryId], references: [id])

  outfitItems OutfitItem[]
  images      WardrobeItemImage[]

  @@index([userId])
  @@index([variantId])
}


model WardrobeItemImage {
  id             String  @id @default(uuid())
  wardrobeItemId String
  imageUrl       String
  altText        String?
  isPrimary      Boolean @default(false)
  displayOrder   Int     @default(0)

  wardrobeItem WardrobeItem @relation(fields: [wardrobeItemId], references: [id], onDelete: Cascade)

  @@index([wardrobeItemId])
}